<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.macaku.core.mapper.OkrCoreMapper">
    <resultMap extends="com.macaku.core.mapper.quadrant.FirstQuadrantMapper.BaseResultMap" id="FirstQuadrantResultMap" type="com.macaku.core.domain.po.quadrant.vo.FirstQuadrantVO">
        <collection property="keyResults" ofType="com.macaku.core.domain.po.inner.KeyResult"
                    resultMap="com.macaku.core.mapper.inner.KeyResultMapper.BaseResultMap" >
            <id property="id" column="k_id" jdbcType="BIGINT"/>
            <result property="firstQuadrantId" column="k_first_quadrant_id" jdbcType="BIGINT"/>
            <result property="content" column="k_content" jdbcType="VARCHAR"/>
            <result property="probability" column="k_probability" jdbcType="TINYINT"/>
            <result property="version" column="k_version" jdbcType="INTEGER"/>
            <result property="isDeleted" column="k_is_deleted" jdbcType="BIT"/>
            <result property="createTime" column="k_create_time" jdbcType="TIMESTAMP"/>
            <result property="updateTime" column="k_update_time" jdbcType="TIMESTAMP"/>
        </collection>
    </resultMap>
    <resultMap extends="com.macaku.core.mapper.quadrant.SecondQuadrantMapper.BaseResultMap" id="SecondQuadrantResultMap" type="com.macaku.core.domain.po.quadrant.vo.SecondQuadrantVO">
        <collection property="priorityNumberOnes" ofType="com.macaku.core.domain.po.inner.PriorityNumberOne"
                    resultMap="com.macaku.core.mapper.inner.PriorityNumberOneMapper.BaseResultMap">
            <id property="id" column="p1_id" jdbcType="BIGINT"/>
            <result property="secondQuadrantId" column="p1_second_quadrant_id" jdbcType="BIGINT"/>
            <result property="content" column="p1_content" jdbcType="VARCHAR"/>
            <result property="isCompleted" column="p1_is_completed" jdbcType="BIT"/>
            <result property="version" column="p1_version" jdbcType="INTEGER"/>
            <result property="isDeleted" column="p1_is_deleted" jdbcType="BIT"/>
            <result property="createTime" column="p1_create_time" jdbcType="TIMESTAMP"/>
            <result property="updateTime" column="p1_update_time" jdbcType="TIMESTAMP"/>
        </collection>
        <collection property="priorityNumberTwos" ofType="com.macaku.core.domain.po.inner.PriorityNumberTwo"
                    resultMap="com.macaku.core.mapper.inner.PriorityNumberTwoMapper.BaseResultMap">
            <id property="id" column="p2_id" jdbcType="BIGINT"/>
            <result property="secondQuadrantId" column="p2_second_quadrant_id" jdbcType="BIGINT"/>
            <result property="content" column="p2_content" jdbcType="VARCHAR"/>
            <result property="isCompleted" column="p2_is_completed" jdbcType="BIT"/>
            <result property="version" column="p2_version" jdbcType="INTEGER"/>
            <result property="isDeleted" column="p2_is_deleted" jdbcType="BIT"/>
            <result property="createTime" column="p2_create_time" jdbcType="TIMESTAMP"/>
            <result property="updateTime" column="p2_update_time" jdbcType="TIMESTAMP"/>
        </collection>
    </resultMap>
    <resultMap extends="com.macaku.core.mapper.quadrant.ThirdQuadrantMapper.BaseResultMap" id="ThirdQuadrantResultMap" type="com.macaku.core.domain.po.quadrant.vo.ThirdQuadrantVO">
        <collection property="actions" ofType="com.macaku.core.domain.po.inner.Action"
                    resultMap="com.macaku.core.mapper.inner.ActionMapper.BaseResultMap">
            <id property="id" column="a_id" jdbcType="BIGINT"/>
            <result property="thirdQuadrantId" column="a_third_quadrant_id" jdbcType="BIGINT"/>
            <result property="content" column="a_content" jdbcType="VARCHAR"/>
            <result property="isCompleted" column="a_is_completed" jdbcType="BIT"/>
            <result property="version" column="a_version" jdbcType="INTEGER"/>
            <result property="isDeleted" column="a_is_deleted" jdbcType="BIT"/>
            <result property="createTime" column="a_create_time" jdbcType="TIMESTAMP"/>
            <result property="updateTime" column="a_update_time" jdbcType="TIMESTAMP"/>
        </collection>
    </resultMap>
    <resultMap extends="com.macaku.core.mapper.quadrant.FourthQuadrantMapper.BaseResultMap" id="FourthQuadrantResultMap" type="com.macaku.core.domain.po.quadrant.vo.FourthQuadrantVO">
        <collection property="statusFlags" ofType="com.macaku.core.domain.po.inner.StatusFlag"
                    resultMap="com.macaku.core.mapper.inner.StatusFlagMapper.BaseResultMap">
            <id property="id" column="sf_id" jdbcType="BIGINT"/>
            <result property="fourthQuadrantId" column="sf_fourth_quadrant_id" jdbcType="BIGINT"/>
            <result property="label" column="sf_label" jdbcType="VARCHAR"/>
            <result property="color" column="sf_color" jdbcType="CHAR"/>
            <result property="version" column="sf_version" jdbcType="INTEGER"/>
            <result property="isDeleted" column="sf_is_deleted" jdbcType="BIT"/>
            <result property="createTime" column="sf_create_time" jdbcType="TIMESTAMP"/>
            <result property="updateTime" column="sf_update_time" jdbcType="TIMESTAMP"/>
        </collection>
    </resultMap>

    <resultMap extends="BaseResultMap" id="AllInfoResultMap" type="com.macaku.core.domain.po.vo.OkrCoreVO">
        <association property="firstQuadrantVO" resultMap="FirstQuadrantResultMap" columnPrefix="f_"/>
        <association property="secondQuadrantVO" resultMap="SecondQuadrantResultMap" columnPrefix="s_"/>
        <association property="thirdQuadrantVO" resultMap="ThirdQuadrantResultMap" columnPrefix="t_"/>
        <association property="fourthQuadrantVO" resultMap="FourthQuadrantResultMap" columnPrefix="fq_"/>
    </resultMap>


    <select id="searchOkrCore" resultMap="AllInfoResultMap">
        select
            o.id,
            f.id f_id, f.core_id f_core_id, f.objective f_objective,
            k.id k_id, k.first_quadrant_id k_first_quadrant_id, k.content k_content, k.probability k_probability,
            s.id s_id, s.core_id s_core_id,
            p1.id p1_id, p1.second_quadrant_id p1_second_quadrant_id, p1.content p1_content, p1.is_completed p1_is_completed,
            p2.id p2_id, p2.second_quadrant_id p2_second_quadrant_id, p2.content p2_content, p2.is_completed p2_is_completed,
            t.id t_id, t.core_id t_core_id,
            a.id a_id, a.third_quadrant_id a_third_quadrant_id, a.content a_content, a.is_completed a_is_completed,
            fq.id fq_id, fq.core_id fq_core_id,
            sf.id sf_id, sf.fourth_quadrant_id sf_fourth_quadrant_id, sf.label sf_label
        from
            okr_core o,
            first_quadrant f left join key_result k on f.id = k.first_quadrant_id,
            second_quadrant s left join priority_number_one p1 on s.id = p1.second_quadrant_id
                              left join priority_number_two p2 on s.id = p2.second_quadrant_id,
            third_quadrant t left join action a on t.id = a.third_quadrant_id,
            fourth_quadrant fq left join status_flag sf on fq.id = sf.fourth_quadrant_id
        where
            o.id = #{id,jdbcType=BIGINT}
          and f.core_id = o.id
          and s.core_id = o.id
          and t.core_id = o.id
          and fq.core_id = o.id
    </select>

</mapper>
